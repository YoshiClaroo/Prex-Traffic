rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /bots/{botId} {
      allow read, create, delete: if request.auth != null;
      allow update: if false;
      
      // Validar estructura de datos al crear
      allow create: if (
        request.auth != null &&
        request.resource.data.url is string &&
        request.resource.data.url.matches('https?://.+') &&
        request.resource.data.duration is number &&
        request.resource.data.duration >= 10 &&
        request.resource.data.duration <= 600 &&
        request.resource.data.repetitions is number &&
        request.resource.data.repetitions >= 50 &&
        request.resource.data.repetitions <= 1000 &&
        request.resource.data.userId == request.auth.uid &&
        request.resource.data.createdAt is timestamp
      );
      
      // Solo el dueÃ±o puede leer/eliminar
      allow read, delete: if resource.data.userId == request.auth.uid;
    }
  }
}
